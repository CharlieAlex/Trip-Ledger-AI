# Trip Ledger AI ğŸ§¾

AI é©…å‹•çš„æ—…éŠç™¼ç¥¨è¨˜å¸³å·¥å…·ï¼Œæ”¯æ´å¤šç¨® AI æ¨¡å‹ï¼ˆGemini / Hugging Faceï¼‰è‡ªå‹•è¾¨è­˜ç™¼ç¥¨ç…§ç‰‡ï¼Œä¸¦æä¾›è±å¯Œçš„è¦–è¦ºåŒ–åˆ†æã€‚

![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)
![Streamlit](https://img.shields.io/badge/Streamlit-1.30+-red.svg)
![Gemini](https://img.shields.io/badge/Gemini-2.0%20Flash-orange.svg)
![Hugging Face](https://img.shields.io/badge/Hugging%20Face-Qwen2--VL-yellow.svg)

---

## ğŸ“¸ æ‡‰ç”¨ç¨‹å¼æˆªåœ–

### é¦–é ç¸½è¦½
![é¦–é ](data/screenshot/homepage.png)

### ç™¼ç¥¨ä¸Šå‚³èˆ‡åœ–ç‰‡è™•ç†
![ä¸Šå‚³ç™¼ç¥¨](data/screenshot/upload.png)

ä¸Šå‚³ç™¼ç¥¨ç…§ç‰‡å¾Œï¼Œå¯è‡ªå‹•èª¿æ•´åœ–ç‰‡å°ºå¯¸ï¼Œé è¦½å¾Œå†é€å‡º AI è¾¨è­˜ã€‚

### ç™¼ç¥¨ç®¡ç†æ¸…å–®
![ç™¼ç¥¨æ¸…å–®](data/screenshot/recipts_list.png)

è¾¨è­˜å®Œæˆçš„ç™¼ç¥¨ä»¥å¡ç‰‡å½¢å¼å‘ˆç¾ï¼Œå¯å³æ™‚ç·¨è¼¯å“é …ã€é¡åˆ¥ã€é‡‘é¡ï¼Œä¹Ÿæ”¯æ´é‡æ–°è¾¨è­˜èˆ‡åˆªé™¤ã€‚

### æ¶ˆè²»æ™‚é–“ç·š
![æ™‚é–“ç·š](data/screenshot/timeline.png)

æŒ‰æ—¥æœŸç¯©é¸ï¼ŒæŸ¥çœ‹ç´¯è¨ˆæ¶ˆè²»è¶¨å‹¢åœ–èˆ‡æ¯æ—¥æ¶ˆè²»æ˜ç´°ã€‚

### çµ±è¨ˆåˆ†æ
![çµ±è¨ˆåˆ†æ](data/screenshot/analysis.png)

æ¶µè“‹é¡åˆ¥åˆ†å¸ƒã€æ¯æ—¥è¶¨å‹¢ã€åº—å®¶åˆ†æèˆ‡å“é …æ˜ç´°ï¼Œæä¾›å¤šç¶­åº¦æ¶ˆè²»æ´å¯Ÿã€‚

### è¨­å®šé é¢
![è¨­å®š](data/screenshot/setting.png)

å¯åˆ‡æ› AI æ¨¡å‹æä¾›è€…ï¼ˆGemini / Hugging Faceï¼‰ã€è¨­å®š API Keyã€èªè¨€åå¥½åŠåŒ¯å‡ºå ±å‘Šã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹è‰²

- ğŸ“¸ **ç™¼ç¥¨ç…§ç‰‡è¾¨è­˜** - ä¸Šå‚³ç™¼ç¥¨ç…§ç‰‡ï¼ŒAI è‡ªå‹•æ“·å–åº—å®¶ã€å“é …ã€é‡‘é¡ç­‰è³‡è¨Š
- ğŸ¤– **å¤šæ¨¡å‹æ”¯æ´** - æ”¯æ´ Google Gemini èˆ‡ Hugging Face æ¨¡å‹ï¼Œå¯è‡ªç”±åˆ‡æ›
- ğŸŒ **å¤šèªç³»æ”¯æ´** - æ”¯æ´æ—¥æ–‡ã€è‹±æ–‡ã€ç¹é«”ä¸­æ–‡ç™¼ç¥¨ï¼Œè‡ªå‹•ç¿»è­¯å“åèˆ‡åº—å
- ğŸ·ï¸ **æ™ºæ…§åˆ†é¡** - è‡ªå‹•å°‡å“é …åˆ†é¡åˆ° 8 å¤§é¡åˆ¥èˆ‡å­é¡åˆ¥
- ğŸ–¼ï¸ **åœ–ç‰‡é è™•ç†** - ä¸Šå‚³æ™‚è‡ªå‹•èª¿æ•´å°ºå¯¸ï¼Œæ”¯æ´ JPEGã€PNGã€HEICã€PDF æ ¼å¼
- ğŸ“… **æ™‚é–“ç·šè¦–è¦ºåŒ–** - æŒ‰æ—¥æœŸæŸ¥çœ‹æ¶ˆè²»è¨˜éŒ„èˆ‡ç´¯è¨ˆè¶¨å‹¢åœ–
- ğŸ“Š **å¤šç¶­åº¦åˆ†æ** - é¡åˆ¥åˆ†å¸ƒã€æ¯æ—¥è¶¨å‹¢ã€åº—å®¶æ’è¡Œã€å“é …æ˜ç´°
- ğŸ“¤ **å ±å‘ŠåŒ¯å‡º** - æ”¯æ´ Excelã€PDF æ ¼å¼åŒ¯å‡º
- ğŸ”„ **ç¿»è­¯åˆ‡æ›** - å…¨åŸŸåˆ‡æ›åŸæ–‡ / ç¿»è­¯åç¨±é¡¯ç¤º
- âš¡ **å¿«å–æ©Ÿåˆ¶** - ç›¸åŒç…§ç‰‡ä¸é‡è¤‡è™•ç†ï¼Œç¯€çœ API ç”¨é‡

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
# ä½¿ç”¨ uv
uv sync
```

### 2. è¨­å®šç’°å¢ƒè®Šæ•¸

å»ºç«‹ `.env` æª”æ¡ˆï¼š

```bash
cp .env.example .env
```

ç·¨è¼¯ `.env`ï¼Œå¡«å…¥ä½ çš„ API Keyï¼š

```env
# é¸æ“‡ AI æä¾›è€… (gemini æˆ– huggingface)
EXTRACTION_PROVIDER=gemini

# Gemini APIï¼ˆprovider ç‚º gemini æ™‚éœ€è¦ï¼‰
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-2.0-flash

# Hugging Faceï¼ˆprovider ç‚º huggingface æ™‚éœ€è¦ï¼‰
HUGGINGFACE_TOKEN=your_huggingface_token_here
HUGGINGFACE_MODEL=Qwen/Qwen2-VL-7B-Instruct
```

æˆ–åœ¨æ‡‰ç”¨ç¨‹å¼çš„ã€Œâš™ï¸ è¨­å®šã€é é¢ä¸­ç›´æ¥è¼¸å…¥ã€‚

### 3. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼

```bash
make run
```

æˆ–ï¼š

```bash
uv run streamlit run src/app.py
```

ç€è¦½å™¨é–‹å•Ÿ http://localhost:8501

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
Trip-Ledger-AI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.py                      # Streamlit ä¸»å…¥å£
â”‚   â”œâ”€â”€ config.py                   # è¨­å®šç®¡ç†ï¼ˆAPI Keyã€è·¯å¾‘ã€èªè¨€ç­‰ï¼‰
â”‚   â”œâ”€â”€ extractors/                 # ç™¼ç¥¨æ“·å–æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ client.py               #   çµ±ä¸€ AI å®¢æˆ¶ç«¯ï¼ˆGemini + HFï¼‰
â”‚   â”‚   â”œâ”€â”€ invoice_parser.py       #   ç™¼ç¥¨è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ category_classifier.py  #   å“é …åˆ†é¡å™¨
â”‚   â”‚   â””â”€â”€ image_preprocessor.py   #   åœ–ç‰‡é è™•ç†
â”‚   â”œâ”€â”€ etl/                        # è³‡æ–™è™•ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ storage.py              #   CSV è³‡æ–™å„²å­˜
â”‚   â”‚   â”œâ”€â”€ models.py               #   Pydantic è³‡æ–™æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ exporter.py             #   å ±å‘ŠåŒ¯å‡ºï¼ˆExcel / PDFï¼‰
â”‚   â”‚   â””â”€â”€ cache.py                #   è™•ç†å¿«å–
â”‚   â”œâ”€â”€ visualization/              # è¦–è¦ºåŒ–æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ charts.py               #   åœ–è¡¨å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ timeline.py             #   æ™‚é–“ç·šå…ƒä»¶
â”‚   â”‚   â””â”€â”€ maps.py                 #   åœ°åœ–å…ƒä»¶
â”‚   â”œâ”€â”€ ui/                         # UI å…ƒä»¶
â”‚   â”‚   â””â”€â”€ sidebar.py              #   å…±ç”¨å´é‚Šæ¬„
â”‚   â””â”€â”€ pages/                      # Streamlit é é¢
â”‚       â”œâ”€â”€ 1_receipts.py           #   ç™¼ç¥¨ç®¡ç†ï¼ˆä¸Šå‚³ / è¾¨è­˜ / ç·¨è¼¯ï¼‰
â”‚       â”œâ”€â”€ 2_timeline.py           #   æ¶ˆè²»æ™‚é–“ç·š
â”‚       â”œâ”€â”€ 3_analysis.py           #   çµ±è¨ˆåˆ†æ
â”‚       â””â”€â”€ 5_settings.py           #   è¨­å®šé é¢
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ photos/                     # ç™¼ç¥¨ç…§ç‰‡
â”‚   â”œâ”€â”€ cache/                      # è™•ç†å¿«å–
â”‚   â”œâ”€â”€ screenshot/                 # æ‡‰ç”¨ç¨‹å¼æˆªåœ–
â”‚   â”œâ”€â”€ categories.json             # é¡åˆ¥å®šç¾©
â”‚   â”œâ”€â”€ receipts.csv                # ç™¼ç¥¨è³‡æ–™
â”‚   â””â”€â”€ items.csv                   # å“é …è³‡æ–™
â”œâ”€â”€ exports/                        # åŒ¯å‡ºå ±å‘Š
â”œâ”€â”€ tests/                          # æ¸¬è©¦
â”œâ”€â”€ .agent/                         # Agent Skills & Workflows
â”œâ”€â”€ Makefile                        # å¸¸ç”¨æŒ‡ä»¤
â”œâ”€â”€ pyproject.toml                  # å°ˆæ¡ˆè¨­å®š
â””â”€â”€ README.md
```

---

## ğŸ› ï¸ å¸¸ç”¨æŒ‡ä»¤

```bash
make help          # é¡¯ç¤ºæ‰€æœ‰å¯ç”¨æŒ‡ä»¤
make sync          # åŒæ­¥ä¾è³´
make run           # å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
make extract       # è™•ç†ç™¼ç¥¨ç…§ç‰‡ï¼ˆä½¿ç”¨å¿«å–ï¼‰
make extract-force # å¼·åˆ¶é‡æ–°è™•ç†æ‰€æœ‰ç™¼ç¥¨
make export-excel  # åŒ¯å‡º Excel å ±å‘Š
make export-pdf    # åŒ¯å‡º PDF å ±å‘Š
make clean-cache   # æ¸…é™¤å¿«å–
make test          # åŸ·è¡Œæ¸¬è©¦
```

---

## ğŸ“Š æ”¯æ´çš„é¡åˆ¥

| é¡åˆ¥ | Emoji | èªªæ˜ | å­é¡åˆ¥ç¯„ä¾‹ |
|------|-------|------|-----------|
| food | ğŸ” | é£Ÿç‰© | meal, snack, groceries |
| beverage | ğŸ¥¤ | é£²æ–™ | coffee, alcohol, soft_drink |
| transport | ğŸšƒ | äº¤é€š | train, taxi, flight, fuel |
| lodging | ğŸ¨ | ä½å®¿ | hotel, hostel, airbnb |
| shopping | ğŸ›ï¸ | è³¼ç‰© | clothing, souvenir, electronics |
| entertainment | ğŸ¢ | å¨›æ¨‚ | ticket, activity, attraction |
| health | ğŸ’Š | é†«ç™‚ | pharmacy, medical |
| other | ğŸ“¦ | å…¶ä»– | uncategorized |

---

## ğŸ§  Agent Skills

æœ¬å°ˆæ¡ˆåŒ…å«å¯é‡è¤‡ä½¿ç”¨çš„ Agent Skillsï¼š

| Skill | èªªæ˜ |
|-------|------|
| **Invoice Extractor** | å¾ç™¼ç¥¨ç…§ç‰‡ä¸­æ“·å–çµæ§‹åŒ–è³‡æ–™ï¼ˆå¤šèªç³»ï¼‰ |
| **Category Classifier** | å°‡å•†å“å“é …æ™ºæ…§åˆ†é¡åˆ°é å®šç¾©é¡åˆ¥ |
| **Geocoder** | ä½¿ç”¨ Google Maps API é€²è¡Œåœ°ç†å®šä½ |

---

## ğŸ’¡ ä½¿ç”¨æç¤º

1. **ç™¼ç¥¨ç…§ç‰‡** - ç¢ºä¿ç…§ç‰‡æ¸…æ™°ã€å…‰ç·šå……è¶³
2. **ä¸€å¼µä¸€ç¥¨** - æ¯å¼µç…§ç‰‡åªåŒ…å«ä¸€å¼µç™¼ç¥¨æ•ˆæœæœ€ä½³
3. **åœ–ç‰‡æ ¼å¼** - æ”¯æ´ JPGã€PNGã€HEICã€PDF æ ¼å¼
4. **å¿«å–æ©Ÿåˆ¶** - ç›¸åŒç…§ç‰‡ä¸æœƒé‡è¤‡è™•ç†ï¼Œä½¿ç”¨ `--force` å¼·åˆ¶é‡æ–°è™•ç†
5. **API ç”¨é‡** - æ¯å¼µç™¼ç¥¨ç´„æ¶ˆè€— 1000-2000 tokens
6. **ç¿»è­¯åˆ‡æ›** - å´é‚Šæ¬„å¯ä¸€éµåˆ‡æ›åŸæ–‡ / ç¿»è­¯åç¨±

---

## ğŸ“„ æˆæ¬Š

MIT License
